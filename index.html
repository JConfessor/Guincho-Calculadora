<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora de Guincho - TruckCalc</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="mb-4">
      <h1 class="text-center text-primary">Calculadora de Guincho</h1>
      <p class="text-center text-muted">
        Veja o resumo detalhado do serviço e entenda como o cálculo é realizado.
      </p>
    </header>

    <main class="container">
      <!-- Card da Calculadora -->
      <div class="calculator-card card p-4 mb-4">
        <h2 class="mb-4 text-center">
          <i class="fas fa-calculator me-2"></i>Informe os Dados do Serviço
        </h2>
        <div class="row g-4">
          <!-- Taxa de Saída -->
          <div class="col-md-6">
            <label class="form-label">
              Taxa de Saída (R$)
              <button
                type="button"
                class="btn btn-link p-0 ms-1 text-muted"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                data-bs-content="Valor fixo para iniciar o serviço."
              >
                <i class="fas fa-question-circle"></i>
              </button>
            </label>
            <div class="input-group">
              <span class="input-group-text">R$</span>
              <input
                type="number"
                id="taxa"
                class="form-control money"
                step="0.01"
                required
              />
            </div>
          </div>
          <!-- Valor por KM -->
          <div class="col-md-6">
            <label class="form-label">
              Valor por KM (R$)
              <button
                type="button"
                class="btn btn-link p-0 ms-1 text-muted"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                data-bs-content="Custo adicional por KM fora da franquia."
              >
                <i class="fas fa-question-circle"></i>
              </button>
            </label>
            <div class="input-group">
              <span class="input-group-text">R$</span>
              <input
                type="number"
                id="km"
                class="form-control money"
                step="0.01"
                required
              />
            </div>
          </div>
          <!-- KM de Franquia -->
          <div class="col-md-6">
            <label class="form-label">
              KM de Franquia
              <button
                type="button"
                class="btn btn-link p-0 ms-1 text-muted"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                data-bs-content="Quantidade de quilômetros inclusos no valor fixo."
              >
                <i class="fas fa-question-circle"></i>
              </button>
            </label>
            <div class="input-group">
              <span class="input-group-text"
                ><i class="fas fa-tachometer-alt"></i
              ></span>
              <input
                type="number"
                id="kmFranquia"
                class="form-control"
                step="1"
                placeholder="Ex.: 40"
              />
            </div>
          </div>
          <!-- KM Total -->
          <div class="col-md-6">
            <label class="form-label">
              KM Total (km)
              <button
                type="button"
                class="btn btn-link p-0 ms-1 text-muted"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                data-bs-content="Distância total percorrida no serviço."
              >
                <i class="fas fa-question-circle"></i>
              </button>
            </label>
            <div class="input-group">
              <span class="input-group-text"
                ><i class="fas fa-tachometer-alt"></i
              ></span>
              <input
                type="number"
                id="kmTotal"
                class="form-control"
                step="0.1"
                readonly
              />
            </div>
          </div>
          <!-- Tempo Estimado -->
          <div class="col-md-6">
            <label class="form-label">
              Tempo Estimado
              <button
                type="button"
                class="btn btn-link p-0 ms-1 text-muted"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                data-bs-content="Tempo total estimado para a execução do serviço."
              >
                <i class="fas fa-question-circle"></i>
              </button>
            </label>
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-clock"></i></span>
              <input
                type="text"
                id="tempoEstimado"
                class="form-control"
                readonly
              />
            </div>
          </div>
          <!-- Adicional Noturno -->
          <div class="col-md-6">
            <label class="form-label">
              Adicional Noturno (%)
              <button
                type="button"
                class="btn btn-link p-0 ms-1 text-muted"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                data-bs-content="Percentual adicional caso o serviço ocorra à noite."
              >
                <i class="fas fa-question-circle"></i>
              </button>
            </label>
            <div class="input-group">
              <span class="input-group-text"><i class="fas fa-moon"></i></span>
              <input
                type="number"
                id="valorAdicional"
                class="form-control"
                step="0.01"
                placeholder="Informe a porcentagem"
              />
              <span class="input-group-text">%</span>
            </div>
          </div>
          <!-- Detalhes de Rota -->
          <div class="col-12">
            <h5>
              Detalhes de Rota
              <button
                type="button"
                class="btn btn-link p-0 ms-1 text-muted"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                data-bs-content="Informe os locais onde o serviço será realizado: ponto de partida, endereço do cliente, destino da entrega e local de retorno."
              >
                <i class="fas fa-question-circle"></i>
              </button>
            </h5>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">
                  Local do Guincho
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Local onde o guincho está disponível para iniciar o atendimento."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-truck"></i
                  ></span>
                  <input
                    type="text"
                    id="localGuincho"
                    class="form-control"
                    placeholder="Ex.: Radar Guincho/Reboques 24 Horas"
                  />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">
                  Local do Cliente
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Endereço do cliente que solicitou o serviço."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-user"></i
                  ></span>
                  <input
                    type="text"
                    id="localCliente"
                    class="form-control"
                    placeholder="Ex.: Santa Maria, RN, Brasil"
                  />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">
                  Local de Entrega
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Destino para onde o veículo será levado."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-truck-moving"></i
                  ></span>
                  <input
                    type="text"
                    id="localEntrega"
                    class="form-control"
                    placeholder="Ex.: Mossoró, RN, Brasil"
                  />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label">
                  Local de Retorno
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Local onde o guincho retorna após o atendimento."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-undo"></i
                  ></span>
                  <input
                    type="text"
                    id="localRetorno"
                    class="form-control"
                    placeholder="Ex.: Radar Guincho/Reboques 24 Horas"
                  />
                </div>
              </div>
              <!-- Botões para ação da rota -->
              <div class="col-12 text-center">
                <div class="btn-group mt-2" role="group">
                  <button
                    class="btn btn-outline-primary"
                    onclick="consultarRota()"
                  >
                    <i class="fas fa-route me-2"></i>Consultar Rota
                  </button>
                  <button
                    class="btn btn-outline-secondary"
                    onclick="abrirGoogleMaps()"
                  >
                    <i class="fas fa-map-marked-alt me-2"></i>Ver no Mapa
                  </button>
                </div>
              </div>
            </div>
          </div>
          <!-- Opções de Nota Fiscal e Pagamento -->
          <div class="col-12">
            <h5>
              Opções de Nota Fiscal e Pagamento
              <button
                type="button"
                class="btn btn-link p-0 ms-1 text-muted"
                data-bs-toggle="popover"
                data-bs-trigger="hover focus"
                data-bs-content="Escolha se deseja emitir Nota Fiscal e informe as taxas e descontos aplicáveis."
              >
                <i class="fas fa-question-circle"></i>
              </button>
            </h5>
            <div class="row g-3 align-items-center">
              <div class="col-md-6">
                <label class="form-label">
                  Emitir Nota Fiscal?
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Selecione 'Sim' para emitir Nota Fiscal e aplicar a taxa correspondente."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <select id="notaFiscalSelect" class="form-select">
                  <option value="sim" selected>Sim</option>
                  <option value="nao">Não</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">
                  Taxa Nota Fiscal (%)
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Percentual aplicado sobre o subtotal caso seja emitida Nota Fiscal."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-percent"></i
                  ></span>
                  <input
                    type="number"
                    id="taxaNotaFiscal"
                    class="form-control"
                    step="0.01"
                    value="5"
                  />
                  <span class="input-group-text">%</span>
                </div>
              </div>
            </div>
            <div class="row g-3 mt-2">
              <div class="col-md-4">
                <label class="form-label">
                  Taxa para Cartão (%)
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Taxa adicional aplicada para pagamentos com cartão."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-credit-card"></i
                  ></span>
                  <input
                    type="number"
                    id="taxaCartao"
                    class="form-control"
                    step="0.01"
                    value="2"
                  />
                  <span class="input-group-text">%</span>
                </div>
              </div>
              <div class="col-md-4">
                <label class="form-label">
                  Desconto para PIX (%)
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Percentual de desconto para pagamentos via PIX."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-mobile-alt"></i
                  ></span>
                  <input
                    type="number"
                    id="descontoPix"
                    class="form-control"
                    step="0.01"
                    value="5"
                  />
                  <span class="input-group-text">%</span>
                </div>
              </div>
              <div class="col-md-4">
                <label class="form-label">
                  Desconto para Dinheiro (%)
                  <button
                    type="button"
                    class="btn btn-link p-0 ms-1 text-muted"
                    data-bs-toggle="popover"
                    data-bs-trigger="hover focus"
                    data-bs-content="Percentual de desconto para pagamentos em espécie."
                  >
                    <i class="fas fa-question-circle"></i>
                  </button>
                </label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-money-bill-wave"></i
                  ></span>
                  <input
                    type="number"
                    id="descontoDinheiro"
                    class="form-control"
                    step="0.01"
                    value="10"
                  />
                  <span class="input-group-text">%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Botões de Ação Gerais -->
        <div class="d-flex justify-content-between mt-4">
          <button
            type="button"
            class="btn btn-outline-secondary"
            onclick="limparCampos()"
          >
            <i class="fas fa-eraser me-2"></i>Limpar
          </button>
          <button
            type="button"
            class="btn btn-primary"
            onclick="performCostCalculation()"
          >
            <i class="fas fa-calculator me-2"></i>Calcular
          </button>
        </div>
      </div>

      <!-- Card do Mapa -->
      <div class="card p-4 mb-4" id="mapCard">
        <h4 class="mb-3 text-center">Rota Calculada</h4>
        <div id="map" style="width: 100%; height: 400px"></div>
      </div>

      <!-- Card de Resultado -->
      <div class="result-card card p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0">Resultado do Cálculo</h4>
          <!-- Ícone de interrogação com popover para explicação geral do cálculo -->
          <button
            type="button"
            class="btn btn-link text-white"
            data-bs-toggle="popover"
            title="Como funciona o cálculo?"
            data-bs-content="O cálculo é composto pela soma da Taxa de Saída, do custo de KM excedente (caso o KM Total ultrapasse a franquia), do adicional noturno e, se aplicável, da taxa da Nota Fiscal."
          >
            <i class="fas fa-question-circle"></i>
          </button>
        </div>
        <hr />
        <!-- Área onde o resultado será injetado -->
        <div id="resultado">
          <div class="text-center text-muted">
            Preencha os dados para ver o cálculo
          </div>
        </div>
        <!-- Botões de Compartilhamento -->
        <div class="btn-group mt-2" role="group">
          <button class="btn btn-success" onclick="compartilharCliente()">
            <i class="fab fa-whatsapp me-2"></i>Compartilhar para Cliente
          </button>
          <button class="btn btn-warning" onclick="compartilharMotorista()">
            <i class="fab fa-whatsapp me-2"></i>Compartilhar para Motorista
          </button>
        </div>
      </div>
    </main>

    <!-- Toast (Notificação) -->
    <div id="toast"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCo6sflpepPLQznadxAQ6-leTdEmMd8-0o&loading=async&callback=initMap"
    ></script>
    <!-- Inicialização dos popovers -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var popoverTriggerList = [].slice.call(
          document.querySelectorAll('[data-bs-toggle="popover"]')
        );
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
          return new bootstrap.Popover(popoverTriggerEl);
        });
      });
    </script>
  </body>
</html>
